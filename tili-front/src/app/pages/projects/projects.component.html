<div class="projects-container">
  <div class="projects-header">
    <h1>ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน</h1>
    <p>ุชุงุจุน ูุงุฏูุฑ ุฌููุน ูุดุงุฑูุนู ูู ููุงู ูุงุญุฏ</p>
    <button class="btn-primary" (click)="openCreateForm()">+ ูุดุฑูุน ุฌุฏูุฏ</button>
  </div>

  <div *ngIf="error" class="error-banner">
    {{ error }}
    <button type="button" (click)="error = null">ร</button>
  </div>

  <div *ngIf="loading" class="loading">ุฌุงุฑู ุชุญููู ุงููุดุงุฑูุนโฆ</div>

  <div *ngIf="!loading" class="filters">
    <div class="search-bar">
      <input type="text" [(ngModel)]="searchTerm" placeholder="ุงูุจุญุซ ุนู ูุดุฑูุน...">
      <span class="search-icon">๐</span>
    </div>

    <div class="status-filters">
      <button *ngFor="let status of statusFilters"
              [class.active]="selectedStatus === status"
              (click)="selectedStatus = status">
        {{ status }} ({{ getStatusCount(status) }})
      </button>
    </div>
  </div>

  <div *ngIf="!loading && projects.length === 0" class="empty-state">
    <p>ูุง ุชูุฌุฏ ูุดุงุฑูุน ุญุงููุงู.</p>
  </div>

  <div *ngIf="!loading && projects.length > 0" class="projects-grid">
    <div *ngFor="let project of filteredProjects" class="project-card">
      <div class="project-header">
        <h3>{{ project.titre }}</h3>
        <span class="status-badge" [ngClass]="getStatutClass(project.statut)">
          {{ getStatutLabel(project.statut) }}
        </span>
      </div>

      <p class="project-description">{{ project.description || 'โ' }}</p>

      <div class="project-details" *ngIf="project.chefProjet">
        <div class="detail">
          <span class="label">ูุฏูุฑ ุงููุดุฑูุน:</span>
          <span class="chef">{{ project.chefProjet }}</span>
        </div>
      </div>

      <div class="project-actions">
        <button class="btn-edit" (click)="openEditForm(project)">ุชุนุฏูู</button>
        <button *ngIf="project.id && project.statut !== 'TERMINE' && project.statut !== 'ANNULE'" class="btn-secondary" (click)="changeStatut(project, 'TERMINE')">ุฅููุงุก</button>
        <button *ngIf="project.id && project.statut !== 'ANNULE'" class="btn-warn" (click)="changeStatut(project, 'ANNULE')">ุฅูุบุงุก</button>
        <button *ngIf="project.id" class="btn-danger" (click)="deleteProject(project)">ุญุฐู</button>
      </div>
    </div>
  </div>

  <!-- Modal ุฅูุดุงุก / ุชุนุฏูู -->
  <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ editingProject ? 'ุชุนุฏูู ุงููุดุฑูุน' : 'ูุดุฑูุน ุฌุฏูุฏ' }}</h3>
      <form (ngSubmit)="saveProject()">
        <div class="form-group">
          <label>ุงูุนููุงู <span class="required">*</span></label>
          <input type="text" [(ngModel)]="formModel.titre" name="titre" required minlength="2" placeholder="ุนููุงู ุงููุดุฑูุน">
          <span *ngIf="formErrors['titre']" class="error-msg">{{ formErrors['titre'] }}</span>
        </div>
        <div class="form-group">
          <label>ุงููุตู</label>
          <textarea [(ngModel)]="formModel.description" name="description" rows="3" placeholder="ูุตู ุงููุดุฑูุน"></textarea>
        </div>
        <div class="form-group">
          <label>ูุฏูุฑ ุงููุดุฑูุน</label>
          <input type="text" [(ngModel)]="formModel.chefProjet" name="chefProjet" placeholder="ุงุณู ูุฏูุฑ ุงููุดุฑูุน">
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">ุฅูุบุงุก</button>
          <button type="submit" class="btn-primary">ุญูุธ</button>
        </div>
      </form>
    </div>
  </div>
</div>
